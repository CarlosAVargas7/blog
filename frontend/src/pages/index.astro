---
export const prerender = false;

import "../styles/global.css";
import { getCollection, type CollectionEntry } from "astro:content";
import { formatDateDDMMYYYY } from "../utils/date";
import BlogManager from "../components/BlogManager";

// Tipos TypeScript
type BlogPost = {
  id: string | number;
  title: string;
  content?: string;
  tags: string[];
  date: string | Date;
  slug?: string;
};

// Carga posts de la colección 'blog' con tipos
let posts: CollectionEntry<"blog">[] = await getCollection("blog");

// Ordena por fecha descendente
posts = posts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Transforma los posts para el componente React con tipos explícitos
const postsForReact: BlogPost[] = posts.map((post, index) => ({
  id: post.slug || index.toString(),
  title: post.data.title,
  content: post.rendered?.html || post.body || "Sin contenido disponible",
  tags: post.data.tags || [],
  date: post.data.date,
  slug: post.slug,
}));
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog</title>
  </head>

  <body>
    <!-- Componente React TypeScript que maneja todo el blog -->
    <BlogManager initialPosts={postsForReact} client:load />
  </body>
</html>